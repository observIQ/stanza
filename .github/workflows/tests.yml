name: Tests
on:
  pull_request:

jobs:
  unit-tests:
    strategy:
      matrix:
        os: [ubuntu-20.04, macos-11, windows-2019]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout Sources
        uses: actions/checkout@v2
      - name: Setup Go
        uses: actions/setup-go@v2
        with:
          go-version: "1.17"
          check-latest: true
      - name: Run Tests
        run: go test -race -coverprofile coverage.txt -coverpkg ./... ./...
      - name: Upload Codecov
        # Only submit code coverage if OS is Linux
        if: matrix.os == 'ubuntu-20.04'
        uses: codecov/codecov-actions@v2
        with:
          files: ./coverage.txt
